
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Aturan untuk folder gambar laporan
    match /report-images/{imageId} {
      // Izinkan siapa saja untuk membaca (melihat) gambar.
      // Ini diperlukan agar admin, mekanik, dan logistik dapat melihat foto kerusakan.
      allow read;

      // Izinkan penulisan (unggah) HANYA jika file tersebut adalah gambar
      // dan ukurannya di bawah 5MB. Ini adalah kompromi keamanan
      // karena aplikasi ini menggunakan sistem login kustom yang tidak
      // mengisi `request.auth` di Storage Rules.
      allow write: if request.resource.size < 5 * 1024 * 1024 &&
                      request.resource.contentType.matches('image/.*');
    }
  }
}
